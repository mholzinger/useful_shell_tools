#!/bin/bash

# accounting
ACN=/tmp/accounting.txt; echo -n "Before :" >> $ACN; date >> $ACN;ls -lahtr /etc/localtime >> $ACN;rpm -qa |grep glibc >> $ACN


# do the things
path=/etc/localtime

if [ ! -L $path ]; then
    SYMEXIST="N"
else
    SYMEXIST="Y"
fi

if [ $SYMEXIST = "Y" ] ; then
    echo "Backing up localtime symlink"
    echo
    unalias cp 2>/dev/null
    cp -P /etc/localtime /etc/localtime.bak
fi


rpm -qa|grep glibc|egrep -v 'headers|common|vzdummy|devel'|egrep '2.17-106.el7_7.7|2.12-1.166.el6_7.7|2.15-0ubuntu10.13|2.19-0ubuntu6.7|2.21-0ubuntu4.1' || yum --disablerepo=bbg* -y update glibc

if [ $SYMEXIST = "Y" ] ; then
    echo "Putting localtime symlink back in place"
    echo
    unalias cp 2>/dev/null
    cp -P /etc/localtime.bak /etc/localtime
fi

echo -n "After :" >> $ACN; date >> $ACN;ls -lahtr /etc/localtime >> $ACN;rpm -qa |grep glibc >> $ACN

